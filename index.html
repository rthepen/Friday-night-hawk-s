<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Roy's Ultimate Timer 4.1</title>
    <style>
        :root {
            /* Veilige zones voor notches en home-bars */
            --safe-top: env(safe-area-inset-top, 0px);
            --safe-bottom: env(safe-area-inset-bottom, 0px);
            --app-height: 100dvh;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: #000;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            text-align: center;
            margin: 0; padding: 0;
            /* Cruciaal: Gebruik dvh voor mobiele browsers */
            height: var(--app-height);
            width: 100vw;
            display: flex; flex-direction: column;
            overflow: hidden;
            /* Voorkomt 'bouncen' van de hele pagina op iOS */
            overscroll-behavior: none; 
        }
        
        /* --- LAYOUT CONTAINERS --- */
        .container {
            /* Rekening houden met safe areas */
            padding: calc(10px + var(--safe-top)) 10px calc(10px + var(--safe-bottom)) 10px;
            height: 100%;
            display: flex; flex-direction: column;
            overflow-y: auto; 
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch; /* Soepel scrollen op iOS */
        }

        /* --- INPUTS --- */
        h1 { font-size: 14px; color: #666; margin: 0 0 5px 0; text-transform: uppercase; letter-spacing: 1px; }
        label { display: block; font-size: 12px; color: #888; margin-bottom: 4px; text-align: left; margin-top: 6px;}
        
        .input-wrapper {
            display: flex; align-items: center; margin-bottom: 4px;
            width: 100%;
        }
        .input-wrapper input {
            flex: 1; text-align: center; font-size: 18px; padding: 10px;
            background: #1c1c1e; border: 1px solid #333;
            border-left: none; border-right: none; color: white;
            border-radius: 0; 
            /* Reset iOS default input styling */
            appearance: none; -webkit-appearance: none; -moz-appearance: textfield;
            min-width: 0;
        }
        .btn-adjust {
            background: #333; color: #fff; border: 1px solid #333;
            font-size: 20px; font-weight: bold; width: 44px; height: 44px; /* Iets groter touch target */
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; touch-action: manipulation;
            user-select: none;
        }
        .btn-minus { border-radius: 8px 0 0 8px; }
        .btn-plus { border-radius: 0 8px 8px 0; }

        input[type="time"] {
            width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #333; 
            background: #1c1c1e; color: white; font-size: 20px;
            display: block;
            appearance: none; -webkit-appearance: none;
            font-family: inherit;
        }

        /* --- TOGGLES --- */
        .toggle-container { display: flex; background: #1c1c1e; border-radius: 8px; padding: 4px; margin-bottom: 12px; flex-shrink: 0; }
        .toggle-btn {
            flex: 1; padding: 10px; border: none; background: transparent;
            color: #666; font-weight: bold; border-radius: 6px; cursor: pointer; font-size: 14px; transition: 0.2s;
        }
        .toggle-btn.active { background: #333; color: #fff; }

        /* --- BUTTONS --- */
        button.action-btn {
            width: 100%; padding: 16px; font-size: 18px; font-weight: bold;
            border: none; border-radius: 12px; cursor: pointer; margin-top: 15px; margin-bottom: 15px;
            flex-shrink: 0; /* Voorkomt dat knop plet */
        }
        .btn-start { background-color: #30D158; color: black; }
        .btn-stop { background-color: #FF453A; color: white; width: auto; padding: 10px 20px; font-size: 14px; border-radius: 8px;}
        .btn-pause { background-color: #FF9F0A; color: black; flex: 1; margin: 0 10px; border-radius: 8px; font-weight: bold; font-size: 18px; border:none;}
        .btn-nav { background: #333; color: white; border: none; width: 55px; border-radius: 8px; font-size: 24px; font-weight: bold; cursor: pointer;}

        /* --- INFO BOX --- */
        .info-bar {
            background: #111; padding: 12px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #333;
            flex-shrink: 0;
        }

        /* --- LIST (PREVIEW & ACTIVE) --- */
        .schedule-list-wrapper {
            flex: 1; 
            text-align: left; background: #000;
            border-top: 1px solid #222;
            overflow-y: auto; /* Zelf scrollen */
            min-height: 100px; /* Zorgt dat hij zichtbaar blijft */
        }
        .schedule-item { padding: 10px; border-bottom: 1px solid #1a1a1a; color: #555; display: flex; align-items: center; font-size: 14px; }
        .schedule-item.active { color: #fff; background: #1c1c1e; border-left: 4px solid #30D158; }
        .col-time { width: 60px; font-family: monospace; color: #888; font-size: 12px; }
        .col-desc { flex: 1; padding: 0 8px; font-weight: 500; }
        .col-dur  { width: 40px; text-align: right; font-weight: bold; }
        
        /* --- TIMER SCREEN SPECIFICS --- */
        #timer-screen { 
            display: none; 
            height: 100%; /* Pakt height van body */
            flex-direction: column; 
            padding-bottom: var(--safe-bottom);
        }
        .progress-container { width: 100%; height: 6px; background: #222; margin-top: var(--safe-top); }
        .progress-fill { height: 100%; background: #30D158; width: 0%; transition: width 0.2s linear; }
        
        .timer-top { 
            flex: 0 0 auto; 
            padding: 15px; border-bottom: 1px solid #333; background: #000; z-index: 10; 
        }
        .top-row { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
        .big-time { font-size: 64px; font-weight: bold; font-variant-numeric: tabular-nums; line-height: 1; letter-spacing: -2px; }
        .status-text { font-size: 14px; font-weight: bold; text-transform: uppercase; color: #888; margin-bottom: 5px;}
        .controls-row { display: flex; justify-content: space-between; height: 55px; margin-top: 10px; }

        /* --- MODAL --- */
        #pause-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 100; justify-content: center; align-items: center; }
        .modal-content { background: #1c1c1e; padding: 25px; border-radius: 16px; width: 85%; max-width: 350px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .modal-btn { display: block; width: 100%; padding: 15px; margin-top: 10px; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="setup-screen" class="container">
        <div class="toggle-container">
            <button class="toggle-btn active" id="btn-mode-endtime" onclick="setMode('endtime')">Eindtijd</button>
            <button class="toggle-btn" id="btn-mode-duration" onclick="setMode('duration')">Tijdsduur</button>
        </div>

        <div id="input-endtime" style="margin-bottom: 5px;">
            <label>Klaar om (HH:MM)</label>
            <input type="time" id="endTimeValue">
        </div>

        <div class="hidden" id="input-duration">
            <label>Totale trainingstijd (min)</label>
            <div class="input-wrapper">
                <button class="btn-adjust btn-minus" onclick="adjustValue('totalMin', -5)">‚àí</button>
                <input type="number" id="totalMin" value="60" inputmode="numeric">
                <button class="btn-adjust btn-plus" onclick="adjustValue('totalMin', 5)">+</button>
            </div>
        </div>

        <div style="display:flex; gap:10px;">
            <div style="flex:1;">
                <label>Rondes</label>
                <div class="input-wrapper">
                    <button class="btn-adjust btn-minus" onclick="adjustValue('rounds', -1)">‚àí</button>
                    <input type="number" id="rounds" value="1" inputmode="numeric">
                    <button class="btn-adjust btn-plus" onclick="adjustValue('rounds', 1)">+</button>
                </div>
            </div>
            <div style="flex:1;">
                <label>Oefeningen</label>
                <div class="input-wrapper">
                    <button class="btn-adjust btn-minus" onclick="adjustValue('exercises', -1)">‚àí</button>
                    <input type="number" id="exercises" value="8" inputmode="numeric">
                    <button class="btn-adjust btn-plus" onclick="adjustValue('exercises', 1)">+</button>
                </div>
            </div>
        </div>

        <label>Sets per oefening</label>
        <div class="input-wrapper">
            <button class="btn-adjust btn-minus" onclick="adjustValue('sets', -1)">‚àí</button>
            <input type="number" id="sets" value="3" inputmode="numeric">
            <button class="btn-adjust btn-plus" onclick="adjustValue('sets', 1)">+</button>
        </div>

        <div style="display:flex; gap:10px;">
            <div style="flex:1;">
                <label>Rust (set)</label>
                <div class="input-wrapper">
                    <button class="btn-adjust btn-minus" onclick="adjustValue('restSec', -5)">‚àí</button>
                    <input type="number" id="restSec" value="30" inputmode="numeric">
                    <button class="btn-adjust btn-plus" onclick="adjustValue('restSec', 5)">+</button>
                </div>
            </div>
            <div style="flex:1;">
                <label>Rust (ronde)</label>
                <div class="input-wrapper">
                    <button class="btn-adjust btn-minus" onclick="adjustValue('roundRestSec', -10)">‚àí</button>
                    <input type="number" id="roundRestSec" value="90" inputmode="numeric">
                    <button class="btn-adjust btn-plus" onclick="adjustValue('roundRestSec', 10)">+</button>
                </div>
            </div>
        </div>

        <div class="info-bar">
            <div style="font-size:12px; color:#888;">WERKTIJD PER SET</div>
            <div style="font-size:30px; font-weight:bold; color:#30D158;" id="live-calc-result">--</div>
            <div id="live-calc-error" style="color:#FF453A; display:none; font-size:12px;">Onmogelijk schema!</div>
        </div>
        
        <button class="action-btn btn-start" id="btn-start-app" onclick="startWorkout()">START TRAINING</button>
        
        <div style="text-align:left; padding:5px 0; font-size:12px; color:#666;">VOORBEELD SCHEMA (VANAF NU):</div>
        <div id="preview-list" class="schedule-list-wrapper">
            </div>
    </div>

    <div id="timer-screen">
        <div class="progress-container">
            <div class="progress-fill" id="total-progress"></div>
        </div>

        <div class="timer-top">
            <div class="top-row">
                <div style="text-align: left;">
                    <div class="status-text" id="current-status">KLAARMAKEN</div>
                    <div class="big-time" id="countdown">--</div>
                </div>
                <div style="text-align: right;">
                    <div class="status-text">KLAAR OM</div>
                    <div style="font-size: 20px; font-weight: bold;" id="display-end-time">--:--</div>
                </div>
            </div>
            
            <div class="controls-row">
                <button class="btn-nav" onclick="skipStep(-1)">‚ùÆ</button>
                <button class="btn-pause" id="btn-pause" onclick="handlePauseClick()">PAUZE</button>
                <button class="btn-nav" onclick="skipStep(1)">‚ùØ</button>
                <button class="btn-stop" style="margin-left: 10px;" onclick="resetApp()">STOP</button>
            </div>
        </div>

        <div class="schedule-list-wrapper" id="schedule-list-active"></div>
    </div>

    <div id="pause-modal">
        <div class="modal-content">
            <h2 style="margin-top:0;">Pauze voorbij</h2>
            <p style="color:#aaa;">Wat wil je doen?</p>
            <button class="modal-btn" style="background: #0A84FF; color: white;" onclick="resolvePause('recalc')">
                ‚è±Ô∏è Inhalen (korter werken)
            </button>
            <button class="modal-btn" style="background: #333; color: white;" onclick="resolvePause('push')">
                üê¢ Eindtijd verzetten
            </button>
        </div>
    </div>

    <script>
        // START IN ENDTIME MODE
        let mode = 'endtime';
        let schedule = [];
        let workTimeSec = 0, restTimeSec = 0, roundRestSec = 0;
        let currentIndex = 0;
        let timerInterval;
        let isPaused = false;
        let audioCtx;
        let workoutStartTime, targetEndTimeDate;

        document.addEventListener('DOMContentLoaded', () => {
            // Listeners voor live berekening
            document.querySelectorAll('input').forEach(i => i.addEventListener('input', calculateRealTime));
            
            // Zet default eindtijd op +1 uur
            const d = new Date(); d.setHours(d.getHours()+1);
            // Format time correctly 00:00
            const timeString = d.toLocaleTimeString('nl-NL', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('endTimeValue').value = timeString;
            
            // Initialiseer UI correct
            setMode('endtime');
        });

        function adjustValue(id, delta) {
            const el = document.getElementById(id);
            let val = parseInt(el.value) || 0;
            val += delta;
            if (val < 1) val = 1; 
            el.value = val;
            calculateRealTime();
        }

        function setMode(newMode) {
            mode = newMode;
            document.getElementById('btn-mode-duration').className = mode==='duration'?'toggle-btn active':'toggle-btn';
            document.getElementById('btn-mode-endtime').className = mode==='endtime'?'toggle-btn active':'toggle-btn';
            
            if (mode==='duration') {
                document.getElementById('input-duration').classList.remove('hidden');
                document.getElementById('input-endtime').classList.add('hidden');
            } else {
                document.getElementById('input-duration').classList.add('hidden');
                document.getElementById('input-endtime').classList.remove('hidden');
            }
            calculateRealTime();
        }

        function calculateRealTime() {
            const rounds = parseInt(document.getElementById('rounds').value) || 1;
            const ex = parseInt(document.getElementById('exercises').value) || 0;
            const sts = parseInt(document.getElementById('sets').value) || 0;
            const rst = parseInt(document.getElementById('restSec').value) || 0;
            const roundRst = parseInt(document.getElementById('roundRestSec').value) || 0;

            if (ex === 0 || sts === 0 || rounds === 0) return;

            const totalSetsInWorkout = rounds * ex * sts;
            const totalStandardRests = (totalSetsInWorkout) - rounds; 
            const totalRoundRests = rounds - 1;

            let availableSec = 0;
            if (mode === 'duration') {
                availableSec = (parseInt(document.getElementById('totalMin').value) || 0) * 60;
            } else {
                const endStr = document.getElementById('endTimeValue').value;
                if (!endStr) return;
                const now = new Date();
                const [h, m] = endStr.split(':');
                const target = new Date(); target.setHours(h, m, 0, 0);
                if (target < now) target.setDate(target.getDate() + 1);
                availableSec = Math.floor((target - now) / 1000);
            }

            const prepTime = 10;
            const totalFixedTime = prepTime + (totalStandardRests * rst) + (totalRoundRests * roundRst);
            const workSecTotal = availableSec - totalFixedTime;

            const btnEl = document.getElementById('btn-start-app');
            const errEl = document.getElementById('live-calc-error');
            const resEl = document.getElementById('live-calc-result');

            if (workSecTotal <= 0) {
                resEl.innerText = "--"; errEl.style.display = "block";
                btnEl.style.opacity = 0.5; btnEl.disabled = true;
                workTimeSec = 0;
                document.getElementById('preview-list').innerHTML = "<div style='padding:10px; color:#555;'>Geen schema mogelijk</div>";
            } else {
                workTimeSec = Math.floor(workSecTotal / totalSetsInWorkout);
                resEl.innerText = workTimeSec + "s"; errEl.style.display = "none";
                btnEl.style.opacity = 1; btnEl.disabled = false;
                
                restTimeSec = rst;
                roundRestSec = roundRst;

                // UPDATE PREVIEW TABEL
                generateScheduleData();
                renderPreviewList();
            }
        }

        // --- CORE DATA GENERATOR ---
        function generateScheduleData() {
            const rounds = parseInt(document.getElementById('rounds').value) || 1;
            const ex = parseInt(document.getElementById('exercises').value);
            const sts = parseInt(document.getElementById('sets').value);
            
            schedule = [];
            schedule.push({ type: 'prep', time: 10, label: "Voorbereiden" });

            for (let r = 1; r <= rounds; r++) {
                for (let e = 1; e <= ex; e++) {
                    for (let s = 1; s <= sts; s++) {
                        schedule.push({ 
                            type: 'work', time: workTimeSec, 
                            label: `Ronde ${r} | Oef ${e} (Set ${s})` 
                        });

                        const isLastSetOfWorkout = (r===rounds && e===ex && s===sts);
                        const isLastSetOfRound = (e===ex && s===sts);

                        if (!isLastSetOfWorkout) {
                            if (isLastSetOfRound) {
                                schedule.push({ type: 'rest-long', time: roundRestSec, label: "GROTE PAUZE" });
                            } else {
                                schedule.push({ type: 'rest', time: restTimeSec, label: "Rust" });
                            }
                        }
                    }
                }
            }
            schedule.push({ type: 'finish', time: 0, label: "KLAAR!" });
        }

        // --- PREVIEW RENDERER (Setup Scherm) ---
        function renderPreviewList() {
            const list = document.getElementById('preview-list');
            list.innerHTML = "";
            let runningDate = new Date();

            schedule.forEach((item) => {
                if (item.type==='finish') return;
                let timeStr = runningDate.toLocaleTimeString('nl-NL', {hour:'2-digit', minute:'2-digit', second:'2-digit'});
                runningDate.setSeconds(runningDate.getSeconds() + item.time);

                const div = document.createElement('div');
                div.className = `schedule-item`;
                if (item.type==='rest-long') div.style.borderLeft = "4px solid #0A84FF";
                
                let icon = "";
                if(item.type==='work') icon='üî•';
                else if(item.type==='rest') icon='üí§';
                else if(item.type==='rest-long') icon='‚òï';
                else icon='üöÄ';

                div.innerHTML = `<div class="col-time">${timeStr}</div><div class="col-desc">${icon} ${item.label}</div><div class="col-dur">${item.time}s</div>`;
                list.appendChild(div);
            });
        }

        // --- ACTIVE RENDERER (Timer Scherm) ---
        function renderActiveList() {
            const list = document.getElementById('schedule-list-active');
            list.innerHTML = "";
            let runningDate = new Date();
            
            schedule.forEach((item, idx) => {
                if (item.type==='finish') return;
                let timeStr = "";
                if (idx >= currentIndex) {
                    timeStr = runningDate.toLocaleTimeString('nl-NL', {hour:'2-digit', minute:'2-digit', second:'2-digit'});
                    runningDate.setSeconds(runningDate.getSeconds() + item.time);
                } else { timeStr = "klaar"; }

                const div = document.createElement('div');
                div.className = `schedule-item ${idx===currentIndex?'active':''}`;
                div.id = `step-${idx}`;
                if (item.type==='rest-long') div.style.borderLeft = "4px solid #0A84FF";
                
                let icon = "";
                if(item.type==='work') icon='üî•'; else if(item.type==='rest') icon='üí§'; else if(item.type==='rest-long') icon='‚òï'; else icon='üöÄ';

                div.innerHTML = `<div class="col-time">${timeStr}</div><div class="col-desc" style="${item.type==='work'?'color:white':''}">${icon} ${item.label}</div><div class="col-dur">${item.time}s</div>`;
                list.appendChild(div);
            });
        }

        // --- START & TIMER LOGIC ---
        function startWorkout() {
            if ('wakeLock' in navigator) navigator.wakeLock.request('screen').catch(console.log);
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();

            generateScheduleData(); // Zeker zijn dat we de laatste versie hebben
            
            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('timer-screen').style.display = 'flex';

            workoutStartTime = new Date();
            if (mode === 'endtime') {
                const [h, m] = document.getElementById('endTimeValue').value.split(':');
                targetEndTimeDate = new Date(); targetEndTimeDate.setHours(h, m, 0, 0);
                if (targetEndTimeDate < workoutStartTime) targetEndTimeDate.setDate(targetEndTimeDate.getDate() + 1);
            } else {
                let totalDur = 0;
                schedule.forEach(s => totalDur += s.time);
                targetEndTimeDate = new Date(workoutStartTime.getTime() + totalDur * 1000);
            }

            updateEndTimeDisplay();
            renderActiveList();
            currentIndex = 0;
            runStep();
        }

        function runStep() {
            if (currentIndex >= schedule.length) return;
            const step = schedule[currentIndex];

            // UI Highlight
            document.querySelectorAll('.schedule-item').forEach(el => el.classList.remove('active'));
            const activeItem = document.getElementById(`step-${currentIndex}`);
            if (activeItem) { activeItem.classList.add('active'); activeItem.scrollIntoView({behavior:'smooth', block:'center'}); }

            const statusEl = document.getElementById('current-status');
            if (step.type==='work') { statusEl.innerText="WERKEN"; statusEl.style.color="#30D158"; playBeep(800,'start'); }
            else if (step.type==='rest') { statusEl.innerText="RUST"; statusEl.style.color="#FF9F0A"; playBeep(400,'end'); }
            else if (step.type==='rest-long') { statusEl.innerText="RONDE PAUZE"; statusEl.style.color="#0A84FF"; playBeep(300,'end'); }
            else if (step.type==='prep') { statusEl.innerText="STARTEN"; statusEl.style.color="#0A84FF"; }
            else { finish(); return; }

            document.getElementById('countdown').innerText = step.time;

            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (!isPaused) {
                    step.time--;
                    document.getElementById('countdown').innerText = step.time;
                    updateProgressBar();
                    
                    if (step.time <= 0) {
                        clearInterval(timerInterval);
                        currentIndex++;
                        runStep();
                    } else if (step.time <= 3) { playBeep(600,'tick'); }
                }
            }, 1000);
        }

        // --- PAUZE & NAVIGATIE ---
        function skipStep(dir) {
            let newIndex = currentIndex + dir;
            if (newIndex < 0) newIndex = 0;
            if (newIndex >= schedule.length - 1) newIndex = schedule.length - 1;
            currentIndex = newIndex;
            renderActiveList(); 
            runStep(); 
        }

        function handlePauseClick() {
            const btn = document.getElementById('btn-pause');
            if (!isPaused) {
                isPaused = true;
                btn.innerText = "HERVAT"; btn.style.backgroundColor = "#30D158";
                document.getElementById('current-status').innerText = "GEPAUZEERD";
                document.getElementById('current-status').style.color = "white";
            } else {
                if (mode === 'endtime') document.getElementById('pause-modal').style.display = 'flex';
                else resolvePause('push');
            }
        }

        function resolvePause(choice) {
            document.getElementById('pause-modal').style.display = 'none';
            document.getElementById('btn-pause').innerText = "PAUZE";
            document.getElementById('btn-pause').style.backgroundColor = "#FF9F0A";
            isPaused = false;
            if (choice === 'recalc') recalculateForFixedEnd();
            else updateTargetTimeFromNow();
            renderActiveList();
        }

        function recalculateForFixedEnd() {
            const now = new Date();
            const secsRemaining = Math.floor((targetEndTimeDate - now) / 1000);
            if (secsRemaining <= 0) { alert("Tijd is op!"); finish(); return; }

            let workStepsLeft = 0; let fixedRest = 0;
            for(let i=currentIndex; i<schedule.length; i++){
                if (schedule[i].type==='finish') continue;
                if (schedule[i].type==='rest' || schedule[i].type==='rest-long') fixedRest += schedule[i].time;
                else if (schedule[i].type==='work' || schedule[i].type==='prep') workStepsLeft++;
            }

            if (workStepsLeft > 0) {
                const availableForWork = secsRemaining - fixedRest;
                let newWork = Math.floor(availableForWork / workStepsLeft);
                if (newWork < 5) newWork = 5; 
                for(let i=currentIndex; i<schedule.length; i++){
                    if (schedule[i].type==='work') schedule[i].time = newWork;
                }
                document.getElementById('countdown').innerText = schedule[currentIndex].time;
            }
        }

        function updateTargetTimeFromNow() {
            let secsLeft = 0;
            for(let i=currentIndex; i<schedule.length; i++) {
                if(schedule[i].type !== 'finish') secsLeft += schedule[i].time;
            }
            const now = new Date();
            targetEndTimeDate = new Date(now.getTime() + secsLeft * 1000);
            updateEndTimeDisplay();
        }

        // --- UTILS ---
        function updateEndTimeDisplay() { document.getElementById('display-end-time').innerText = targetEndTimeDate.toLocaleTimeString('nl-NL',{hour:'2-digit',minute:'2-digit'}); }
        function updateProgressBar() {
            const now = new Date();
            const totalMs = targetEndTimeDate - workoutStartTime; 
            if (totalMs <= 0) return;
            const elapsed = now - workoutStartTime;
            let pct = (elapsed / totalMs) * 100; if (pct>100) pct=100;
            document.getElementById('total-progress').style.width = pct + "%";
        }
        function finish() {
            document.getElementById('current-status').innerText = "KLAAR!";
            document.getElementById('current-status').style.color = "white";
            document.getElementById('countdown').innerText = "üéâ";
            document.getElementById('btn-pause').style.display='none';
            playBeep(1000,'win');
        }
        function resetApp() { clearInterval(timerInterval); location.reload(); }
        function playBeep(f,t){
            if(!audioCtx)return;
            const o=audioCtx.createOscillator(),g=audioCtx.createGain();
            o.connect(g);g.connect(audioCtx.destination);
            o.frequency.value=f;o.type='sine';
            const n=audioCtx.currentTime;
            if(t==='tick'){g.gain.setValueAtTime(0.1,n);o.start(n);o.stop(n+0.1);}
            else if(t==='win'){g.gain.setValueAtTime(0.1,n);o.start(n);o.stop(n+0.2);setTimeout(()=>playBeep(1200,'tick'),300);}
            else{g.gain.setValueAtTime(0.3,n);o.start(n);o.stop(n+0.5);}
        }
    </script>
</body>
</html>
